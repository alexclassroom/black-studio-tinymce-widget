/* Black Studio TinyMCE Widget */
var bstw;!function(a){bstw=function(b){var c=null;return"string"==typeof b?c=b:"object"==typeof b&&b instanceof jQuery&&(c=a("textarea[id^=widget-black-studio-tinymce][id$=text]",b.closest(bstwData.container_selectors)).attr("id")),{activate:function(b){var d,e;return b="undefined"!=typeof b?b:!0,a("#"+c).hasClass("active")||(a("#"+c).hasClass("activating")||a("#"+c).addClass("activating"),this.isQuicktagsConfigured()||(tinyMCEPreInit.qtInit[c]=tinyMCEPreInit.qtInit["black-studio-tinymce-widget"],tinyMCEPreInit.qtInit[c].id=c),this.isQuicktagsActive()||(d=QTags.instances,QTags.instances=[],quicktags(tinyMCEPreInit.qtInit[c]),QTags._buttonsInit(),e=QTags.instances[c],QTags.instances=d,QTags.instances[c]=e),this.isTinymceConfigured()||"undefined"!=typeof tinyMCEPreInit.mceInit["black-studio-tinymce-widget"]&&(tinyMCEPreInit.mceInit[c]=tinyMCEPreInit.mceInit["black-studio-tinymce-widget"],tinyMCEPreInit.mceInit[c].selector="#"+c),this.isTinymceConfigured()&&(!this.isTinymceActive()&&"visual"===this.getMode()&&a("#"+c).is(":visible")?(tinyMCEPreInit.mceInit[c].setup=function(b){b.on("keyup change",function(){"visual"===bstw(c).getMode()&&bstw(c).updateContent(),a("#"+c).change()}),a("#"+c).addClass("active").removeClass("activating")},b?tinymce.init(tinyMCEPreInit.mceInit[c]):this.go()):this.isTinymceActive()||"visual"!==this.getMode()?a("#"+c).addClass("active").removeClass("activating"):setTimeout(function(){bstw(c).activate(b)},500))),this},deactivate:function(){return a("#"+c).hasClass("activating")||(this.isTinymceActive()&&tinymce.get(c).remove(),this.isTinymceConfigured()&&delete tinyMCEPreInit.mceInit[c],this.isQuicktagsActive()&&(a(".quicktags-toolbar",this.getWidgetInside()).remove(),delete QTags.instances[c]),this.isQuicktagsConfigured()&&delete tinyMCEPreInit.qtInit[c],a("#"+c).removeClass("active")),this},updateContent:function(){var a;return this.isTinymceConfigured()&&("visual"===this.getMode()?(a=tinymce.get(c).save(),tinyMCEPreInit.mceInit[c].wpautop&&(a=window.switchEditors.pre_wpautop(a)),this.getTextarea().val(a)):this.isTinymceActive()&&(a=this.getTextarea().val(),tinyMCEPreInit.mceInit[c].wpautop&&(a=window.switchEditors.wpautop(a)),tinymce.get(c).setContent(a))),this},go:function(a){return"undefined"==typeof a&&(a=this.getMode()),window.switchEditors.go(c,"visual"===a?"tmce":"html"),this},getMode:function(){return a("input[id^=widget-black-studio-tinymce][id$=type]",this.getContainer()).val()},setMode:function(b){return a("input[id^=widget-black-studio-tinymce][id$=type]",this.getContainer()).val(b),this},getContainer:function(){return a("#"+c).closest(bstwData.container_selectors)},getWidget:function(){return a("#"+c).closest("div.widget")},getWidgetInside:function(){return a("#"+c).closest("div.widget-inside")},getTextarea:function(){return a("#"+c)},isTinymceActive:function(){return"object"==typeof tinymce&&"object"==typeof tinymce.get(c)&&null!==tinymce.get(c)},isTinymceConfigured:function(){return"undefined"!=typeof tinyMCEPreInit.mceInit[c]},isQuicktagsActive:function(){return"object"==typeof QTags.instances[c]},isQuicktagsConfigured:function(){return"object"==typeof tinyMCEPreInit.qtInit[c]},prepare:function(){return 1<a('[name="'+this.getTextarea().attr("name")+'"]').size()&&0===a("div.error",this.getWidgetInside()).length&&this.getWidgetInside().prepend('<div class="error"><strong>'+bstwData.error_duplicate_id+"</strong></div>"),this.getWidget().css("position","relative").css("z-index","100000"),a("#wpbody-content").css("overflow","visible"),this},responsive:function(){var b,c,d,e,f,g;return this.getWidgetInside().is(":visible")&&(b=parseInt(a("input[name=widget-width]",this.getWidget()).val(),10),c=a(window).width(),d=this.getWidget().parent().width(),e=parseInt(a("#wpcontent").css("margin-left"),10),f=!("undefined"==typeof isRtl||!isRtl),b+e+30>c&&(g=this.getWidget().closest("div.widget-liquid-right").length?f?"margin-right":"margin-left":f?"margin-left":"margin-right",this.getWidget().css(g,d-(c-30-e)+"px"))),this}}},a(document).ready(function(){a(document).on("click","div.widget[id*=black-studio-tinymce] .widget-title, div.widget[id*=black-studio-tinymce] .widget-title-action",function(){a(this).parents("#available-widgets").length||(bstw(a(this)).prepare().responsive().activate(!1),a("input[name=savewidget]",bstw(a(this)).getWidget()).on("click",function(){var b=a(this).closest(".widget").find(".wp-editor-wrap").height();a(this).closest(".widget").find(".wp-editor-wrap").height(b).append('<div class="bstw-loading"></div>'),a(this).closest(".widget").find(".bstw-loading").height(b).show(),bstw(a(this)).updateContent()}))}),a(document).on("widget-added",function(a,b){b.is("[id*=black-studio-tinymce]")&&(a.preventDefault(),bstw(b).activate())}),a(document).on("widget-updated",function(a,b){b.is("[id*=black-studio-tinymce]")&&(a.preventDefault(),bstw(b).deactivate().activate())}),a(document).on("expand",function(b){var c=bstw(a("textarea[id^=widget-black-studio-tinymce][id$=text]",b.target)).getWidget();c.is("[id*=black-studio-tinymce]")&&(b.preventDefault(),setTimeout(function(){bstw(c).deactivate().activate()},500))}),a(document).on("widget-synced",function(a,b){b.is("[id*=black-studio-tinymce]")&&(a.preventDefault(),"visual"===bstw(b).getMode()&&bstw(b).updateContent())}),a(document).on("click","[id^=widget-black-studio-tinymce][id$=tmce]",function(){bstw(a(this)).setMode("visual")}),a(document).on("click","[id^=widget-black-studio-tinymce][id$=html]",function(){bstw(a(this)).setMode("html")}),a(document).on("click.wp-editor",".wp-editor-wrap",function(){this.id&&(window.wpActiveEditor=this.id.slice(3,-5))}),a(document).on("sortstart",function(b,c){var d;(a(c.item).is(".widget")||a(c.item).is(".customize-control"))&&(a(c.item).is(".ui-draggable")||(d=["body.wp-customizer .expanded > div[id*=black-studio-tinymce].widget",".widget-liquid-right div[id*=black-studio-tinymce].widget.open"],a(d.join(", ")).filter(":has(.widget-inside:visible)").each(function(){a(".widget-title",this).trigger("click"),bstw(a(this)).deactivate()}),c.item.is("[id*=black-studio-tinymce]")&&bstw(c.item.find("textarea[id^=widget-black-studio-tinymce]")).deactivate()))}),a(document).on("sortupdate",function(b,c){(null===b||a(c.item).is(".widget")&&!a(c.item).is(".ui-draggable"))&&(a("body").addClass("wait"),setTimeout(function(){a("textarea[id^=widget-black-studio-tinymce].active").each(function(){bstw(a(this)).deactivate()}),a("body").removeClass("wait")},1e3))}),a(document).on("click","body.wp-customizer div[id*=black-studio-tinymce].widget .move-widget-btn",function(){var b=a(this);a("body").addClass("wait"),setTimeout(function(){a("textarea[id^=widget-black-studio-tinymce].active").each(function(){bstw(a(this)).deactivate()}),bstw(b).activate(),a("body").removeClass("wait")},1e3)}),"object"==typeof bstwData.activate_events&&0<bstwData.activate_events.length&&a(document).on(bstwData.activate_events.join(" "),function(b){bstw(a(b.target)).activate()}),"object"==typeof bstwData.deactivate_events&&0<bstwData.deactivate_events.length&&a(document).on(bstwData.deactivate_events.join(" "),function(b){bstw(a(b.target)).deactivate()}),a(window).resize(function(){a("textarea[id^=widget-black-studio-tinymce]").each(function(){bstw(a(this)).responsive()})}),a(document).on("click",".bstw-visual-editor-disabled-notice .notice-dismiss",function(){a.ajax({url:ajaxurl,data:{action:"bstw_visual_editor_disabled_dismiss_notice"}})}),a("#qt_widget-black-studio-tinymce-__i__-text_toolbar").remove(),a(document).on("click",".bstw-links-icon",function(b){b.preventDefault(),a(this).closest(".bstw-links").children(".bstw-links-list").toggle()}),"undefined"!=typeof wp.media.view.settings.post.id&&0===wp.media.view.settings.post.id&&(wp.media.view.settings.post.id=bstwData.dummy_post_id)})}(jQuery);